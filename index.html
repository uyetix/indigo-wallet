<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INDIGO | Самостоятельный TON Кошелёк</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- TON библиотеки -->
    <script src="https://unpkg.com/@ton/crypto@3.2.0/dist/index.min.js"></script>
    <script src="https://unpkg.com/@ton/core@0.53.0/dist/index.min.js"></script>
    <script src="https://unpkg.com/@ton/ton@13.11.1/dist/index.min.js"></script>
    
    <!-- Иконки -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Service Worker для PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }
    </script>
    
    <style>
        /* ===== СБРОС СТИЛЕЙ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* ===== ОСНОВНЫЕ ПЕРЕМЕННЫЕ ===== */
        :root {
            --bg-primary: #000000;
            --bg-secondary: #111111;
            --bg-tertiary: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --text-tertiary: #636366;
            --accent-indigo: #4B0082;
            --accent-indigo-light: #6A11CB;
            --accent-blue: #007AFF;
            --accent-green: #34C759;
            --accent-red: #FF3B30;
            --accent-yellow: #FFCC00;
            --border-color: #2C2C2E;
            --border-light: #3A3A3C;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --radius-small: 10px;
            --radius-medium: 14px;
            --radius-large: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== БАЗОВЫЕ СТИЛИ ===== */
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
        }

        /* Градиентный фон */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(75, 0, 130, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(106, 17, 203, 0.1) 0%, transparent 50%);
            animation: gradientShift 20s ease infinite;
            z-index: -1;
        }

        /* ===== КОНТЕЙНЕР ===== */
        .app-container {
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        /* ===== ЗАГРУЗЧИК ===== */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.3s;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(75, 0, 130, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-indigo);
            animation: spin 1s linear infinite;
        }

        /* ===== ОСНОВНЫЕ ЭКРАНЫ ===== */
        .screen {
            display: none;
            flex: 1;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        /* ШАПКА */
        .header {
            padding: 20px 0 30px;
            margin-bottom: 20px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-indigo), transparent);
        }

        .back-button {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: var(--radius-small);
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .screen-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #FFFFFF, #E5E5EA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .screen-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        /* ===== ГЛАВНЫЙ ЭКРАН ===== */
        .main-screen {
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .logo-container {
            margin-bottom: 40px;
            position: relative;
        }

        .logo-icon {
            width: 100px;
            height: 100px;
            border-radius: var(--radius-large);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 900;
            margin: 0 auto 24px;
            position: relative;
            background: linear-gradient(135deg, 
                #4B0082 0%, 
                #6A11CB 25%, 
                #2575fc 50%, 
                #764ba2 75%, 
                #4B0082 100%);
            background-size: 300% 300%;
            animation: gradientFlow 4s ease infinite;
            box-shadow: 
                0 20px 40px rgba(75, 0, 130, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            color: white;
        }

        .app-name {
            font-size: 48px;
            font-weight: 900;
            letter-spacing: -1px;
            background: linear-gradient(135deg, 
                #FFFFFF 0%, 
                #E5E5EA 25%, 
                #D1D1D6 50%, 
                #FFFFFF 75%, 
                #E5E5EA 100%);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 6s ease infinite;
            line-height: 1;
            margin-bottom: 12px;
        }

        .app-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 0.3px;
            margin-bottom: 60px;
            max-width: 280px;
            line-height: 1.5;
        }

        /* КНОПКИ */
        .button {
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-indigo-light));
            color: white;
            border: none;
            border-radius: var(--radius-medium);
            padding: 18px 24px;
            font-size: 17px;
            font-weight: 600;
            width: 100%;
            max-width: 320px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 8px auto;
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .button:hover::before {
            left: 100%;
        }

        .button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(75, 0, 130, 0.3);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .button-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .button-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-light);
        }

        .button-small {
            padding: 12px 20px;
            font-size: 15px;
            max-width: 200px;
        }

        /* КАРТОЧКИ */
        .card {
            background: rgba(17, 17, 17, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-large);
            padding: 24px;
            margin-bottom: 20px;
            backdrop-filter: blur(20px);
            transition: var(--transition);
        }

        .card:hover {
            border-color: var(--border-light);
            background: rgba(26, 26, 26, 0.8);
        }

        /* ФОРМЫ */
        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            padding: 16px;
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            transition: var(--transition);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-indigo);
            box-shadow: 0 0 0 2px rgba(75, 0, 130, 0.2);
        }

        .textarea-field {
            min-height: 100px;
            resize: vertical;
        }

        /* МНЕМОНИЧЕСКАЯ ФРАЗА */
        .mnemonic-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 24px 0;
        }

        @media (min-width: 480px) {
            .mnemonic-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .mnemonic-word {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            padding: 16px 12px;
            text-align: center;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 15px;
            color: var(--text-primary);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .mnemonic-word::before {
            content: attr(data-index);
            position: absolute;
            top: 4px;
            left: 8px;
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .mnemonic-word.copied {
            background: rgba(52, 199, 89, 0.1);
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .mnemonic-word:hover {
            border-color: var(--border-light);
            background: rgba(40, 40, 40, 0.8);
        }

        /* ===== ЭКРАН КОШЕЛЬКА ===== */
        /* БАЛАНС */
        .balance-section {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: var(--radius-large);
            padding: 28px 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .balance-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-indigo), var(--accent-indigo-light));
        }

        .balance-label {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .refresh-btn {
            background: rgba(75, 0, 130, 0.1);
            border: 1px solid rgba(75, 0, 130, 0.3);
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: var(--radius-small);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .refresh-btn:hover {
            background: rgba(75, 0, 130, 0.2);
            color: var(--text-primary);
        }

        .balance-amount {
            font-size: 52px;
            font-weight: 800;
            letter-spacing: -1.5px;
            margin-bottom: 6px;
            line-height: 1;
            font-variant-numeric: tabular-nums;
            background: linear-gradient(135deg, #FFFFFF, #E5E5EA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .balance-usd {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 500;
            font-variant-numeric: tabular-nums;
        }

        /* ТОКЕНЫ */
        .tokens-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .token-item {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
            cursor: pointer;
        }

        .token-item:hover {
            border-color: var(--border-light);
            background: rgba(40, 40, 40, 0.8);
        }

        .token-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .token-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-small);
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-indigo-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
        }

        .token-details {
            flex: 1;
        }

        .token-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .token-symbol {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .token-balance {
            text-align: right;
        }

        .token-amount {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .token-usd {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* БЫСТРЫЕ ДЕЙСТВИЯ */
        .quick-actions {
            margin: 24px 0;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        @media (max-width: 480px) {
            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .action-button {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
            transition: var(--transition);
            cursor: pointer;
            min-height: 100px;
        }

        .action-button:hover {
            background-color: var(--bg-tertiary);
            transform: translateY(-2px);
            border-color: var(--border-light);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: var(--transition);
        }

        .action-button:hover .action-icon {
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-indigo-light));
            transform: scale(1.05);
        }

        .action-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* АДРЕС КОШЕЛЬКА */
        .address-section {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-large);
            padding: 24px;
            margin-bottom: 28px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .address-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(75, 0, 130, 0.5), transparent);
        }

        .address-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .address-title {
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .address-display {
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-medium);
            padding: 18px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 15px;
            letter-spacing: -0.3px;
            word-break: break-all;
            margin-bottom: 20px;
            line-height: 1.5;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            user-select: all;
        }

        /* ИСТОРИЯ ТРАНЗАКЦИЙ */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .history-item {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .history-item:hover {
            border-color: var(--border-light);
            background: rgba(40, 40, 40, 0.8);
        }

        .history-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-small);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .history-icon.send {
            background: rgba(255, 59, 48, 0.1);
            color: var(--accent-red);
        }

        .history-icon.receive {
            background: rgba(52, 199, 89, 0.1);
            color: var(--accent-green);
        }

        .history-details {
            flex: 1;
        }

        .history-type {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .history-address {
            font-size: 14px;
            color: var(--text-secondary);
            font-family: 'SF Mono', Monaco, Consolas, monospace;
        }

        .history-amount {
            text-align: right;
            font-weight: 600;
            font-size: 16px;
        }

        .history-amount.send {
            color: var(--accent-red);
        }

        .history-amount.receive {
            color: var(--accent-green);
        }

        /* NFT ГАЛЕРЕЯ */
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        @media (min-width: 768px) {
            .nft-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .nft-item {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
        }

        .nft-item:hover {
            border-color: var(--border-light);
            transform: translateY(-2px);
        }

        .nft-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-indigo-light));
        }

        .nft-info {
            padding: 12px;
        }

        .nft-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nft-collection {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* СТЕЙКИНГ */
        .staking-section {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-large);
            padding: 24px;
            margin-bottom: 24px;
        }

        .staking-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .validators-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .validator-item {
            background: rgba(40, 40, 40, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
            cursor: pointer;
        }

        .validator-item:hover {
            border-color: var(--border-light);
            background: rgba(50, 50, 50, 0.8);
        }

        .validator-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .validator-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-small);
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-indigo-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .validator-details {
            flex: 1;
        }

        .validator-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .validator-apy {
            font-size: 14px;
            color: var(--accent-green);
        }

        .validator-stake {
            text-align: right;
        }

        /* SWAP */
        .swap-section {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-large);
            padding: 24px;
            margin-bottom: 24px;
        }

        .swap-input {
            margin-bottom: 16px;
        }

        .swap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .swap-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .swap-balance {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .swap-arrow {
            text-align: center;
            margin: 16px 0;
            font-size: 24px;
            color: var(--text-secondary);
        }

        .swap-info {
            background: rgba(40, 40, 40, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            padding: 16px;
            margin-top: 16px;
        }

        .swap-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .swap-info-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .swap-info-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
        }

        /* МОДАЛЬНЫЕ ОКНА */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10001;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-large);
            padding: 28px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-indigo), var(--accent-indigo-light));
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .modal-input {
            width: 100%;
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 16px;
            font-family: 'SF Mono', monospace;
            transition: var(--transition);
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--accent-indigo);
            box-shadow: 0 0 0 2px rgba(75, 0, 130, 0.2);
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* УВЕДОМЛЕНИЯ */
        .notification {
            position: fixed;
            bottom: 24px;
            left: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-large);
            padding: 18px;
            display: none;
            align-items: center;
            gap: 14px;
            z-index: 10000;
            box-shadow: var(--shadow);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            max-width: 500px;
            margin: 0 auto;
        }

        .notification.show {
            display: flex;
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            color: var(--accent-green);
        }

        .notification.error .notification-icon {
            color: var(--accent-red);
        }

        .notification.warning .notification-icon {
            color: var(--accent-yellow);
        }

        .notification.info .notification-icon {
            color: var(--accent-blue);
        }

        .notification-message {
            flex: 1;
            font-size: 15px;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* ФУТЕР */
        .footer {
            padding: 30px 20px;
            text-align: center;
            border-top: 1px solid rgba(44, 44, 46, 0.5);
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.7);
            margin-top: auto;
        }

        .security-note {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 20px;
            line-height: 1.5;
            padding: 0 20px;
        }

        .security-note i {
            margin-right: 8px;
            color: var(--accent-green);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 32px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 15px;
            transition: var(--transition);
            padding: 8px 0;
            position: relative;
        }

        .footer-link::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-indigo), transparent);
            opacity: 0;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: white;
        }

        .footer-link:hover::after {
            opacity: 1;
        }

        /* АНИМАЦИИ */
        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes gradientShift {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* ===== АДАПТИВНОСТЬ ===== */
        @media (max-width: 480px) {
            .app-name {
                font-size: 36px;
            }
            
            .app-subtitle {
                font-size: 16px;
                margin-bottom: 40px;
            }
            
            .button {
                padding: 16px;
                font-size: 16px;
                max-width: 280px;
            }
            
            .screen-title {
                font-size: 28px;
            }
            
            .balance-amount {
                font-size: 44px;
            }
            
            .security-note {
                font-size: 13px;
            }
            
            .footer-links {
                gap: 20px;
            }
        }

        @media (min-width: 768px) {
            .main-screen {
                padding: 60px 40px;
            }
            
            .logo-icon {
                width: 120px;
                height: 120px;
                font-size: 56px;
            }
            
            .app-name {
                font-size: 56px;
            }
            
            .app-subtitle {
                font-size: 20px;
                max-width: 400px;
            }
            
            .button {
                max-width: 360px;
                padding: 20px 32px;
                font-size: 18px;
            }
        }

        @media (orientation: landscape) and (max-height: 600px) {
            .main-screen {
                padding: 20px;
                flex-direction: row;
                text-align: left;
                justify-content: space-between;
                gap: 40px;
            }
            
            .logo-container {
                margin-bottom: 0;
                flex-shrink: 0;
            }
            
            .app-subtitle {
                margin-bottom: 30px;
            }
            
            .footer {
                padding: 20px;
            }
        }

        @media (max-width: 360px) {
            .main-screen {
                padding: 30px 16px;
            }
            
            .app-name {
                font-size: 32px;
            }
            
            .logo-icon {
                width: 80px;
                height: 80px;
                font-size: 40px;
                margin-bottom: 20px;
            }
            
            .button {
                font-size: 15px;
                padding: 14px;
                max-width: 260px;
            }
        }

        /* ПРОГРЕСС БАР */
        .progress-bar {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-indigo), var(--accent-indigo-light));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ВАЛИДАТОРЫ */
        .validator-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .validator-option:hover {
            border-color: var(--border-light);
            background: rgba(40, 40, 40, 0.8);
        }

        .validator-option.selected {
            border-color: var(--accent-indigo);
            background: rgba(75, 0, 130, 0.1);
        }

        .validator-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .validator-checkbox.selected {
            background: var(--accent-indigo);
            border-color: var(--accent-indigo);
        }

        .validator-checkbox.selected::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        /* ТАБЫ */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 16px;
            font-size: 16px;
            color: var(--text-secondary);
            background: none;
            border: none;
            cursor: pointer;
            white-space: nowrap;
            position: relative;
            transition: var(--transition);
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            color: var(--text-primary);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-indigo), var(--accent-indigo-light));
        }

        /* СЕЛЕКТЫ */
        .select {
            position: relative;
            width: 100%;
        }

        .select-button {
            width: 100%;
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            color: var(--text-primary);
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .select-button:hover {
            border-color: var(--border-light);
        }

        .select-button:focus {
            border-color: var(--accent-indigo);
            outline: none;
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            margin-top: 4px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .select-options.show {
            display: block;
        }

        .select-option {
            padding: 12px 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .select-option:hover {
            background: var(--bg-tertiary);
        }

        .select-option.selected {
            background: rgba(75, 0, 130, 0.1);
            color: var(--accent-indigo-light);
        }

        .select-option-icon {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-small);
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-indigo-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
        }

        /* СЕТЬ И СТАТУС */
        .network-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(17, 17, 17, 0.9);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            padding: 8px 16px;
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 999;
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--accent-green);
            animation: pulse 2s infinite;
        }

        .status-dot.offline {
            background-color: var(--accent-red);
        }

        .status-dot.syncing {
            background-color: var(--accent-yellow);
        }

        /* ЦЕНЫ */
        .price-change {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: var(--radius-small);
            margin-left: 8px;
        }

        .price-change.positive {
            background: rgba(52, 199, 89, 0.1);
            color: var(--accent-green);
        }

        .price-change.negative {
            background: rgba(255, 59, 48, 0.1);
            color: var(--accent-red);
        }

        /* QR КОД */
        .qr-container {
            padding: 20px;
            background: white;
            border-radius: var(--radius-medium);
            display: inline-block;
            margin: 20px auto;
        }

        /* СЛАЙДЕР */
        .slider {
            width: 100%;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-indigo);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-indigo);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        /* ДРОПДАУН */
        .dropdown {
            position: relative;
        }

        .dropdown-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(40, 40, 40, 0.8);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .dropdown-toggle:hover {
            border-color: var(--border-light);
            background: rgba(50, 50, 50, 0.8);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-medium);
            min-width: 200px;
            margin-top: 8px;
            z-index: 100;
            display: none;
            box-shadow: var(--shadow);
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-item:hover {
            background: var(--bg-tertiary);
        }

        .dropdown-item.danger {
            color: var(--accent-red);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 8px 0;
        }

        /* СКЕЛЕТОН */
        .skeleton {
            background: linear-gradient(90deg, 
                rgba(40, 40, 40, 0.8) 25%, 
                rgba(50, 50, 50, 0.8) 50%, 
                rgba(40, 40, 40, 0.8) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-medium);
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ПУСТЫЕ СОСТОЯНИЯ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .empty-description {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 24px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ТОСТЫ */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-large);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10000;
            box-shadow: var(--shadow);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            max-width: 400px;
            margin: 0 auto;
        }

        .toast.hidden {
            animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes slideDown {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        /* КОНФИРМАЦИЯ */
        .confirmation {
            text-align: center;
            padding: 20px;
        }

        .confirmation-icon {
            width: 80px;
            height: 80px;
            background: rgba(52, 199, 89, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: var(--accent-green);
            margin: 0 auto 20px;
        }

        .confirmation-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .confirmation-message {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 24px;
        }

        /* ТЕМЫ */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-indigo-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 20px rgba(75, 0, 130, 0.3);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(75, 0, 130, 0.4);
        }
    </style>
</head>
<body>
    <!-- ЗАГРУЗЧИК -->
    <div class="loader-overlay" id="loader">
        <div class="loader"></div>
    </div>

    <!-- СТАТУС СЕТИ -->
    <div class="network-status" id="network-status">
        <div class="status-dot" id="status-dot"></div>
        <span id="network-text">Подключение...</span>
    </div>

    <!-- ПЕРЕКЛЮЧАТЕЛЬ ТЕМЫ -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
    </div>

    <!-- ОСНОВНОЙ КОНТЕЙНЕР -->
    <div class="app-container">
        <!-- ГЛАВНЫЙ ЭКРАН -->
        <div id="main-screen" class="screen active">
            <div class="logo-container">
                <div class="logo-icon">I</div>
                <h1 class="app-name">INDIGO</h1>
                <p class="app-subtitle">Некастодиальный TON кошелёк нового поколения</p>
            </div>
            
            <button class="button" onclick="showScreen('create-screen')">
                <i class="fas fa-wallet"></i>
                Создать кошелёк
            </button>
            
            <button class="button button-secondary" onclick="showScreen('recover-screen')">
                <i class="fas fa-redo"></i>
                Восстановить кошелёк
            </button>
            
            <button class="button button-secondary" onclick="unlockWallet()" id="unlock-btn" style="display: none;">
                <i class="fas fa-lock-open"></i>
                Разблокировать кошелёк
            </button>
        </div>

        <!-- ЭКРАН СОЗДАНИЯ -->
        <div id="create-screen" class="screen">
            <div class="header">
                <button class="back-button" onclick="showScreen('main-screen')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="screen-title">Создание кошелька</h2>
                <p class="screen-subtitle">
                    Сгенерируем вашу секретную фразу. Запишите её и храните в безопасном месте.
                </p>
            </div>
            
            <div class="card">
                <div class="input-group">
                    <label class="input-label">Название кошелька (опционально)</label>
                    <input type="text" class="input-field" id="wallet-name" placeholder="Например: Основной кошелёк" maxlength="32">
                </div>
                
                <button class="button" onclick="generateMnemonic()" id="generate-btn">
                    <i class="fas fa-key"></i>
                    Сгенерировать секретную фразу
                </button>
            </div>
            
            <div id="mnemonic-section" style="display: none;">
                <div class="card">
                    <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">
                        <i class="fas fa-shield-alt" style="color: var(--accent-green); margin-right: 8px;"></i>
                        Ваша секретная фраза (24 слова)
                    </h3>
                    <div class="mnemonic-grid" id="mnemonic-grid"></div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button class="button-secondary" onclick="copyMnemonic()">
                            <i class="fas fa-copy"></i>
                            Копировать все
                        </button>
                        <button class="button" onclick="showScreen('confirm-screen')">
                            Продолжить
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="card" style="background: rgba(255, 59, 48, 0.05); border-color: rgba(255, 59, 48, 0.2);">
                    <h4 style="color: var(--accent-red); margin-bottom: 12px; font-size: 16px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        Важное предупреждение
                    </h4>
                    <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
                        1. Никогда никому не передавайте секретную фразу<br>
                        2. Запишите фразу на бумаге и храните в безопасном месте<br>
                        3. INDIGO не хранит ваши ключи и не может восстановить доступ<br>
                        4. Эта фраза — единственный способ восстановить кошелёк
                    </p>
                </div>
            </div>
        </div>

        <!-- ЭКРАН ПОДТВЕРЖДЕНИЯ -->
        <div id="confirm-screen" class="screen">
            <div class="header">
                <button class="back-button" onclick="showScreen('create-screen')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="screen-title">Подтверждение фразы</h2>
                <p class="screen-subtitle">
                    Введите слова из секретной фразы в правильном порядке для подтверждения.
                </p>
            </div>
            
            <div class="card">
                <div id="confirm-words" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 24px;"></div>
                
                <div class="input-group">
                    <label class="input-label">Введите слово #<span id="current-word-index">1</span></label>
                    <input type="text" class="input-field" id="confirm-input" placeholder="Введите слово..." autocomplete="off">
                </div>
                
                <div style="display: flex; gap: 12px;">
                    <button class="button-secondary" onclick="showScreen('create-screen')">
                        <i class="fas fa-redo"></i>
                        Начать заново
                    </button>
                    <button class="button" onclick="confirmWord()" id="confirm-btn">
                        Подтвердить
                        <i class="fas fa-check"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- ЭКРАН ПАРОЛЯ -->
        <div id="password-screen" class="screen">
            <div class="header">
                <button class="back-button" onclick="showScreen('confirm-screen')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="screen-title">Защита паролем</h2>
                <p class="screen-subtitle">
                    Установите пароль для дополнительной защиты вашего кошелька.
                </p>
            </div>
            
            <div class="card">
                <div class="input-group">
                    <label class="input-label">Пароль (минимум 6 символов)</label>
                    <input type="password" class="input-field" id="password-input" placeholder="Введите пароль" minlength="6">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Подтверждение пароля</label>
                    <input type="password" class="input-field" id="confirm-password" placeholder="Повторите пароль" minlength="6">
                </div>
                
                <div class="input-group" style="margin-top: 24px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="backup-checkbox" style="width: 20px; height: 20px;">
                        <span style="color: var(--text-secondary); font-size: 14px;">
                            Я сохранил секретную фразу в безопасном месте
                        </span>
                    </label>
                </div>
                
                <button class="button" onclick="createWallet()" id="create-wallet-btn" disabled>
                    <i class="fas fa-wallet"></i>
                    Создать кошелёк
                </button>
            </div>
        </div>

        <!-- ЭКРАН ВОССТАНОВЛЕНИЯ -->
        <div id="recover-screen" class="screen">
            <div class="header">
                <button class="back-button" onclick="showScreen('main-screen')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="screen-title">Восстановление кошелька</h2>
                <p class="screen-subtitle">
                    Введите вашу секретную фразу из 24 слов для восстановления доступа.
                </p>
            </div>
            
            <div class="card">
                <div class="input-group">
                    <label class="input-label">Секретная фраза (24 слова)</label>
                    <textarea class="input-field textarea-field" id="recovery-mnemonic" 
                              placeholder="Введите 24 слова через пробел" rows="3"></textarea>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Название кошелька (опционально)</label>
                    <input type="text" class="input-field" id="recovery-name" 
                           placeholder="Например: Восстановленный кошелёк">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Пароль для шифрования</label>
                    <input type="password" class="input-field" id="recovery-password" 
                           placeholder="Новый пароль" minlength="6">
                </div>
                
                <button class="button" onclick="recoverWallet()" id="recover-btn">
                    <i class="fas fa-redo"></i>
                    Восстановить кошелёк
                </button>
            </div>
        </div>

        <!-- ЭКРАН РАЗБЛОКИРОВКИ -->
        <div id="unlock-screen" class="screen">
            <div class="header">
                <button class="back-button" onclick="showScreen('main-screen')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="screen-title">Разблокировка кошелька</h2>
                <p class="screen-subtitle">
                    Введите пароль для доступа к вашему кошельку.
                </p>
            </div>
            
            <div class="card">
                <div class="input-group">
                    <label class="input-label">Пароль</label>
                    <input type="password" class="input-field" id="unlock-password" 
                           placeholder="Введите пароль" autocomplete="current-password">
                </div>
                
                <button class="button" onclick="unlockWalletWithPassword()" id="unlock-wallet-btn">
                    <i class="fas fa-lock-open"></i>
                    Разблокировать
                </button>
                
                <button class="button button-secondary" onclick="forgotPassword()" style="margin-top: 12px;">
                    <i class="fas fa-question-circle"></i>
                    Забыли пароль?
                </button>
            </div>
        </div>

        <!-- ОСНОВНОЙ ЭКРАН КОШЕЛЬКА -->
        <div id="wallet-screen" class="screen">
            <!-- ШАПКА КОШЕЛЬКА -->
            <div class="header">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="back-button" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                    <div class="dropdown">
                        <button class="dropdown-toggle" onclick="toggleDropdown('wallet-dropdown')">
                            <span id="wallet-title">Кошелёк</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu" id="wallet-dropdown">
                            <div class="dropdown-item" onclick="showBackupModal()">
                                <i class="fas fa-key"></i>
                                Показать секретную фразу
                            </div>
                            <div class="dropdown-item" onclick="exportWallet()">
                                <i class="fas fa-download"></i>
                                Экспорт кошелька
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-item" onclick="showSettings()">
                                <i class="fas fa-cog"></i>
                                Настройки
                            </div>
                            <div class="dropdown-item danger" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                Выйти
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2 class="screen-title" id="wallet-name-display">TON Кошелёк</h2>
                <p class="screen-subtitle">
                    Некастодиальный кошелёк • Ключи хранятся только у вас
                </p>
            </div>

            <!-- ТАБЫ -->
            <div class="tabs" id="wallet-tabs">
                <button class="tab active" onclick="switchTab('assets')" data-tab="assets">
                    <i class="fas fa-coins"></i> Активы
                </button>
                <button class="tab" onclick="switchTab('nft')" data-tab="nft">
                    <i class="fas fa-gem"></i> NFT
                </button>
                <button class="tab" onclick="switchTab('staking')" data-tab="staking">
                    <i class="fas fa-chart-line"></i> Стейкинг
                </button>
                <button class="tab" onclick="switchTab('history')" data-tab="history">
                    <i class="fas fa-history"></i> История
                </button>
                <button class="tab" onclick="switchTab('swap')" data-tab="swap">
                    <i class="fas fa-exchange-alt"></i> Обмен
                </button>
            </div>

            <!-- ТАБ: АКТИВЫ -->
            <div class="tab-content active" data-tab="assets">
                <!-- БАЛАНС TON -->
                <div class="balance-section">
                    <div class="balance-label">
                        Баланс TON
                        <button class="refresh-btn" onclick="updateBalance()" id="refresh-btn">
                            <span id="refresh-text">Обновить</span>
                            <i class="fas fa-sync-alt" id="refresh-icon"></i>
                        </button>
                    </div>
                    <div class="balance-amount" id="balance-ton">0.00</div>
                    <div class="balance-usd" id="balance-usd">≈ $0.00</div>
                </div>

                <!-- БЫСТРЫЕ ДЕЙСТВИЯ -->
                <div class="quick-actions">
                    <div class="actions-grid">
                        <button class="action-button" onclick="showSendModal()">
                            <div class="action-icon">📤</div>
                            <div class="action-label">Отправить</div>
                        </button>
                        <button class="action-button" onclick="showReceiveModal()">
                            <div class="action-icon">📥</div>
                            <div class="action-label">Получить</div>
                        </button>
                        <button class="action-button" onclick="showBuyModal()">
                            <div class="action-icon">💳</div>
                            <div class="action-label">Купить</div>
                        </button>
                        <button class="action-button" onclick="switchTab('swap')">
                            <div class="action-icon">🔄</div>
                            <div class="action-label">Обмен</div>
                        </button>
                    </div>
                </div>

                <!-- ТОКЕНЫ -->
                <div class="tokens-list" id="tokens-list">
                    <!-- Динамически заполняется -->
                </div>

                <!-- АДРЕС -->
                <div class="address-section">
                    <div class="address-header">
                        <div class="address-title">Ваш адрес TON</div>
                        <button class="button-small button-secondary" onclick="copyAddress()">
                            <i class="fas fa-copy"></i> Копировать
                        </button>
                    </div>
                    <div class="address-display" id="wallet-address">
                        Загрузка...
                    </div>
                </div>
            </div>

            <!-- ТАБ: NFT -->
            <div class="tab-content" data-tab="nft">
                <div class="empty-state" id="nft-empty">
                    <div class="empty-icon">🎨</div>
                    <div class="empty-title">Нет NFT</div>
                    <div class="empty-description">
                        У вас пока нет NFT. Приобретите их на маркетплейсах TON.
                    </div>
                    <button class="button button-secondary" onclick="openNFTMarketplace()">
                        <i class="fas fa-external-link-alt"></i>
                        Открыть маркетплейс
                    </button>
                </div>
                <div class="nft-grid" id="nft-grid" style="display: none;">
                    <!-- Динамически заполняется -->
                </div>
            </div>

            <!-- ТАБ: СТЕЙКИНГ -->
            <div class="tab-content" data-tab="staking">
                <div class="staking-section">
                    <h3 style="margin-bottom: 20px; font-size: 20px; color: var(--text-primary);">
                        <i class="fas fa-chart-line" style="color: var(--accent-green); margin-right: 8px;"></i>
                        Стейкинг TON
                    </h3>
                    
                    <div class="staking-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="staked-amount">0</div>
                            <div class="stat-label">Застейкано</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="estimated-rewards">0</div>
                            <div class="stat-label">Награды/год</div>
                        </div>
                    </div>

                    <button class="button" onclick="showStakeModal()" id="stake-btn">
                        <i class="fas fa-lock"></i>
                        Застейкать TON
                    </button>
                    
                    <button class="button button-secondary" onclick="showUnstakeModal()" id="unstake-btn" style="margin-top: 12px;">
                        <i class="fas fa-unlock"></i>
                        Вывести из стейкинга
                    </button>
                </div>

                <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">
                    Валидаторы
                </h3>
                
                <div class="validators-list" id="validators-list">
                    <!-- Динамически заполняется -->
                </div>
            </div>

            <!-- ТАБ: ИСТОРИЯ -->
            <div class="tab-content" data-tab="history">
                <div class="empty-state" id="history-empty">
                    <div class="empty-icon">📊</div>
                    <div class="empty-title">Нет транзакций</div>
                    <div class="empty-description">
                        Здесь будет отображаться история ваших транзакций.
                    </div>
                </div>
                <div class="history-list" id="history-list" style="display: none;">
                    <!-- Динамически заполняется -->
                </div>
            </div>

            <!-- ТАБ: ОБМЕН -->
            <div class="tab-content" data-tab="swap">
                <div class="swap-section">
                    <h3 style="margin-bottom: 20px; font-size: 20px; color: var(--text-primary);">
                        <i class="fas fa-exchange-alt" style="color: var(--accent-indigo); margin-right: 8px;"></i>
                        Обмен токенов
                    </h3>
                    
                    <!-- ОТДАЕТЕ -->
                    <div class="swap-input">
                        <div class="swap-header">
                            <div class="swap-label">Отдаете</div>
                            <div class="swap-balance">Баланс: <span id="from-balance">0 TON</span></div>
                        </div>
                        <div class="select">
                            <button class="select-button" onclick="toggleSelect('from-token-select')">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div class="select-option-icon">TON</div>
                                    <span>TON</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="select-options" id="from-token-select">
                                <div class="select-option selected" onclick="selectToken('from', 'TON')">
                                    <div class="select-option-icon">TON</div>
                                    <span>TON</span>
                                </div>
                                <!-- Другие токены добавляются динамически -->
                            </div>
                        </div>
                        <input type="number" class="modal-input" id="from-amount" placeholder="0.0" step="0.001" min="0.001">
                    </div>

                    <!-- СТРЕЛКА -->
                    <div class="swap-arrow">
                        <i class="fas fa-arrow-down" onclick="switchTokens()" style="cursor: pointer;"></i>
                    </div>

                    <!-- ПОЛУЧАЕТЕ -->
                    <div class="swap-input">
                        <div class="swap-header">
                            <div class="swap-label">Получаете</div>
                            <div class="swap-balance">Баланс: <span id="to-balance">0</span></div>
                        </div>
                        <div class="select">
                            <button class="select-button" onclick="toggleSelect('to-token-select')">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div class="select-option-icon">USDT</div>
                                    <span>USDT</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="select-options" id="to-token-select">
                                <div class="select-option selected" onclick="selectToken('to', 'USDT')">
                                    <div class="select-option-icon">USDT</div>
                                    <span>USDT</span>
                                </div>
                                <!-- Другие токены добавляются динамически -->
                            </div>
                        </div>
                        <input type="number" class="modal-input" id="to-amount" placeholder="0.0" readonly>
                    </div>

                    <!-- ИНФОРМАЦИЯ -->
                    <div class="swap-info">
                        <div class="swap-info-item">
                            <div class="swap-info-label">Курс</div>
                            <div class="swap-info-value">1 TON = <span id="exchange-rate">0</span> USDT</div>
                        </div>
                        <div class="swap-info-item">
                            <div class="swap-info-label">Комиссия</div>
                            <div class="swap-info-value" id="swap-fee">0.5%</div>
                        </div>
                        <div class="swap-info-item">
                            <div class="swap-info-label">Минимально получите</div>
                            <div class="swap-info-value" id="min-receive">0 USDT</div>
                        </div>
                    </div>

                    <button class="button" onclick="executeSwap()" id="swap-btn">
                        <i class="fas fa-exchange-alt"></i>
                        Обменять
                    </button>
                </div>
            </div>
        </div>

        <!-- НАСТРОЙКИ -->
        <div id="settings-screen" class="screen">
            <div class="header">
                <button class="back-button" onclick="showScreen('wallet-screen')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="screen-title">Настройки</h2>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">
                    <i class="fas fa-user-circle"></i> Профиль
                </h3>
                
                <div class="input-group">
                    <label class="input-label">Название кошелька</label>
                    <input type="text" class="input-field" id="settings-wallet-name" 
                           placeholder="Название кошелька">
                </div>
                
                <button class="button" onclick="updateWalletName()">
                    <i class="fas fa-save"></i>
                    Сохранить
                </button>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">
                    <i class="fas fa-shield-alt"></i> Безопасность
                </h3>
                
                <button class="button-secondary" onclick="showBackupModal()" style="margin-bottom: 12px;">
                    <i class="fas fa-key"></i>
                    Показать секретную фразу
                </button>
                
                <button class="button-secondary" onclick="exportWallet()" style="margin-bottom: 12px;">
                    <i class="fas fa-download"></i>
                    Экспорт кошелька
                </button>
                
                <button class="button-secondary" onclick="changePassword()">
                    <i class="fas fa-lock"></i>
                    Сменить пароль
                </button>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">
                    <i class="fas fa-wifi"></i> Сеть
                </h3>
                
                <div class="select" style="margin-bottom: 20px;">
                    <button class="select-button" onclick="toggleSelect('network-select')">
                        <span id="current-network">Основная сеть (mainnet)</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="select-options" id="network-select">
                        <div class="select-option selected" onclick="selectNetwork('mainnet')">
                            Основная сеть (mainnet)
                        </div>
                        <div class="select-option" onclick="selectNetwork('testnet')">
                            Тестовая сеть (testnet)
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">RPC URL (опционально)</label>
                    <input type="text" class="input-field" id="rpc-url" 
                           placeholder="https://toncenter.com/api/v2/jsonRPC">
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">
                    <i class="fas fa-cog"></i> Дополнительно
                </h3>
                
                <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; cursor: pointer;">
                    <input type="checkbox" id="auto-lock" style="width: 20px; height: 20px;">
                    <span>Автоматическая блокировка</span>
                </label>
                
                <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; cursor: pointer;">
                    <input type="checkbox" id="price-alerts" style="width: 20px; height: 20px;">
                    <span>Уведомления о цене</span>
                </label>
                
                <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; cursor: pointer;">
                    <input type="checkbox" id="tx-notifications" style="width: 20px; height: 20px;">
                    <span>Уведомления о транзакциях</span>
                </label>
            </div>
            
            <div class="card" style="background: rgba(255, 59, 48, 0.05); border-color: rgba(255, 59, 48, 0.2);">
                <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--accent-red);">
                    <i class="fas fa-exclamation-triangle"></i> Опасная зона
                </h3>
                
                <button class="button button-secondary" style="background: rgba(255, 59, 48, 0.1); color: var(--accent-red); border-color: rgba(255, 59, 48, 0.3); margin-bottom: 12px;" onclick="clearCache()">
                    <i class="fas fa-trash"></i>
                    Очистить кэш
                </button>
                
                <button class="button button-secondary" style="background: rgba(255, 59, 48, 0.1); color: var(--accent-red); border-color: rgba(255, 59, 48, 0.3);" onclick="deleteWallet()">
                    <i class="fas fa-skull-crossbones"></i>
                    Удалить кошелёк
                </button>
            </div>
        </div>

        <!-- ФУТЕР -->
        <div class="footer">
            <div class="security-note">
                <i class="fas fa-shield-alt"></i>
                Некастодиальный кошелёк • Ключи хранятся только у вас • Версия 1.0.0
            </div>
            <div class="footer-links">
                <a href="#" class="footer-link" onclick="showAbout()">О проекте</a>
                <a href="#" class="footer-link" onclick="showHelp()">Помощь</a>
                <a href="#" class="footer-link" onclick="showTerms()">Условия</a>
                <a href="#" class="footer-link" onclick="showPrivacy()">Конфиденциальность</a>
            </div>
        </div>

        <!-- МОДАЛЬНЫЕ ОКНА -->
        <!-- ОТПРАВКА -->
        <div class="modal" id="send-modal">
            <div class="modal-content">
                <div class="modal-title">Отправить TON</div>
                
                <div class="input-group">
                    <label class="input-label">Адрес получателя</label>
                    <input type="text" class="modal-input" id="send-address" 
                           placeholder="EQ... или имя.ton" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Сумма (TON)</label>
                    <input type="number" class="modal-input" id="send-amount" 
                           placeholder="0.0" step="0.001" min="0.001">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Комментарий (опционально)</label>
                    <input type="text" class="modal-input" id="send-comment" 
                           placeholder="Назначение платежа" maxlength="128">
                </div>
                
                <div class="swap-info">
                    <div class="swap-info-item">
                        <div class="swap-info-label">Комиссия сети</div>
                        <div class="swap-info-value" id="tx-fee">~0.05 TON</div>
                    </div>
                    <div class="swap-info-item">
                        <div class="swap-info-label">Итого</div>
                        <div class="swap-info-value" id="tx-total">0 TON</div>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('send-modal')">Отмена</button>
                    <button class="button" onclick="confirmSend()" id="send-confirm-btn">
                        <span id="send-text">Отправить</span>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- ПОЛУЧЕНИЕ -->
        <div class="modal" id="receive-modal">
            <div class="modal-content">
                <div class="modal-title">Получить TON</div>
                
                <div style="text-align: center; padding: 20px;">
                    <div class="qr-container" id="qr-code"></div>
                </div>
                
                <div class="address-display" id="receive-address-display">...</div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('receive-modal')">Закрыть</button>
                    <button class="button" onclick="copyReceiveAddress()">
                        <i class="fas fa-copy"></i> Копировать адрес
                    </button>
                    <button class="button" onclick="shareAddress()">
                        <i class="fas fa-share"></i> Поделиться
                    </button>
                </div>
            </div>
        </div>

        <!-- ПОКУПКА -->
        <div class="modal" id="buy-modal">
            <div class="modal-content">
                <div class="modal-title">Купить TON</div>
                
                <div class="input-group">
                    <label class="input-label">Сумма (TON)</label>
                    <input type="number" class="modal-input" id="buy-amount" 
                           placeholder="0.0" step="0.001" min="0.001">
                </div>
                
                <div class="swap-info">
                    <div class="swap-info-item">
                        <div class="swap-info-label">Цена TON</div>
                        <div class="swap-info-value" id="ton-price">$0.00</div>
                    </div>
                    <div class="swap-info-item">
                        <div class="swap-info-label">Итого к оплате</div>
                        <div class="swap-info-value" id="buy-total">$0.00</div>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('buy-modal')">Отмена</button>
                    <button class="button" onclick="buyWithCard()">
                        <i class="fas fa-credit-card"></i> Картой
                    </button>
                    <button class="button" onclick="buyWithCrypto()">
                        <i class="fas fa-coins"></i> Криптой
                    </button>
                </div>
            </div>
        </div>

        <!-- СТЕЙКИНГ -->
        <div class="modal" id="stake-modal">
            <div class="modal-content">
                <div class="modal-title">Стейкинг TON</div>
                
                <div class="input-group">
                    <label class="input-label">Сумма для стейкинга (TON)</label>
                    <input type="number" class="modal-input" id="stake-amount" 
                           placeholder="0.0" step="0.001" min="1">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Валидатор</label>
                    <div class="select">
                        <button class="select-button" onclick="toggleSelect('validator-select')">
                            <span id="selected-validator">Выберите валидатора</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="select-options" id="validator-select">
                            <!-- Заполняется динамически -->
                        </div>
                    </div>
                </div>
                
                <div class="swap-info">
                    <div class="swap-info-item">
                        <div class="swap-info-label">APR (годовая ставка)</div>
                        <div class="swap-info-value" id="validator-apr">4.2%</div>
                    </div>
                    <div class="swap-info-item">
                        <div class="swap-info-label">Награды в год</div>
                        <div class="swap-info-value" id="yearly-rewards">0 TON</div>
                    </div>
                    <div class="swap-info-item">
                        <div class="swap-info-label">Минимальный стейк</div>
                        <div class="swap-info-value">1 TON</div>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('stake-modal')">Отмена</button>
                    <button class="button" onclick="confirmStake()" id="stake-confirm-btn">
                        <i class="fas fa-lock"></i> Застейкать
                    </button>
                </div>
            </div>
        </div>

        <!-- ВЫВОД ИЗ СТЕЙКИНГА -->
        <div class="modal" id="unstake-modal">
            <div class="modal-content">
                <div class="modal-title">Вывод из стейкинга</div>
                
                <div class="input-group">
                    <label class="input-label">Сумма для вывода (TON)</label>
                    <input type="number" class="modal-input" id="unstake-amount" 
                           placeholder="0.0" step="0.001" min="0.001">
                </div>
                
                <div class="swap-info">
                    <div class="swap-info-item">
                        <div class="swap-info-label">Доступно для вывода</div>
                        <div class="swap-info-value" id="available-unstake">0 TON</div>
                    </div>
                    <div class="swap-info-item">
                        <div class="swap-info-label">Период вывода</div>
                        <div class="swap-info-value">3-5 дней</div>
                    </div>
                    <div class="swap-info-item">
                        <div class="swap-info-label">Комиссия</div>
                        <div class="swap-info-value">0.01 TON</div>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('unstake-modal')">Отмена</button>
                    <button class="button" onclick="confirmUnstake()" id="unstake-confirm-btn">
                        <i class="fas fa-unlock"></i> Вывести
                    </button>
                </div>
            </div>
        </div>

        <!-- РЕЗЕРВНАЯ КОПИЯ -->
        <div class="modal" id="backup-modal">
            <div class="modal-content">
                <div class="modal-title">Секретная фраза</div>
                
                <div style="background: rgba(255, 59, 48, 0.05); border: 1px solid rgba(255, 59, 48, 0.2); border-radius: var(--radius-medium); padding: 16px; margin-bottom: 20px;">
                    <p style="color: var(--accent-red); font-size: 14px; line-height: 1.5; margin-bottom: 12px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        Никогда никому не передавайте эти слова!
                    </p>
                    <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.5;">
                        Тот, кто имеет эти слова, имеет полный контроль над вашими средствами.
                    </p>
                </div>
                
                <div class="mnemonic-grid" id="backup-mnemonic"></div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('backup-modal')">Закрыть</button>
                    <button class="button" onclick="copyBackup()">
                        <i class="fas fa-copy"></i> Копировать
                    </button>
                </div>
            </div>
        </div>

        <!-- ЭКСПОРТ -->
        <div class="modal" id="export-modal">
            <div class="modal-content">
                <div class="modal-title">Экспорт кошелька</div>
                
                <div class="input-group">
                    <label class="input-label">Формат экспорта</label>
                    <div class="select">
                        <button class="select-button" onclick="toggleSelect('export-format-select')">
                            <span>JSON (рекомендуется)</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="select-options" id="export-format-select">
                            <div class="select-option selected" onclick="selectExportFormat('json')">
                                JSON (рекомендуется)
                            </div>
                            <div class="select-option" onclick="selectExportFormat('mnemonic')">
                                Только мнемоническая фраза
                            </div>
                            <div class="select-option" onclick="selectExportFormat('private-key')">
                                Приватный ключ
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Пароль для шифрования</label>
                    <input type="password" class="modal-input" id="export-password" 
                           placeholder="Новый пароль (опционально)" minlength="6">
                </div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('export-modal')">Отмена</button>
                    <button class="button" onclick="generateExport()" id="export-btn">
                        <i class="fas fa-download"></i> Экспортировать
                    </button>
                </div>
            </div>
        </div>

        <!-- СМЕНА ПАРОЛЯ -->
        <div class="modal" id="password-modal">
            <div class="modal-content">
                <div class="modal-title">Смена пароля</div>
                
                <div class="input-group">
                    <label class="input-label">Текущий пароль</label>
                    <input type="password" class="modal-input" id="current-password" 
                           placeholder="Введите текущий пароль">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Новый пароль</label>
                    <input type="password" class="modal-input" id="new-password" 
                           placeholder="Новый пароль" minlength="6">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Подтверждение пароля</label>
                    <input type="password" class="modal-input" id="confirm-new-password" 
                           placeholder="Повторите новый пароль" minlength="6">
                </div>
                
                <div class="modal-buttons">
                    <button class="button button-secondary" onclick="closeModal('password-modal')">Отмена</button>
                    <button class="button" onclick="changeWalletPassword()" id="change-password-btn">
                        <i class="fas fa-lock"></i> Сменить пароль
                    </button>
                </div>
            </div>
        </div>

        <!-- ПОДТВЕРЖДЕНИЕ -->
        <div class="modal" id="confirmation-modal">
            <div class="modal-content">
                <div class="confirmation">
                    <div class="confirmation-icon" id="confirmation-icon">✓</div>
                    <div class="confirmation-title" id="confirmation-title">Успешно!</div>
                    <div class="confirmation-message" id="confirmation-message">
                        Операция выполнена успешно.
                    </div>
                    <div class="modal-buttons">
                        <button class="button" onclick="closeModal('confirmation-modal')">
                            ОК
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ПОДТВЕРЖДЕНИЕ УДАЛЕНИЯ -->
        <div class="modal" id="delete-modal">
            <div class="modal-content">
                <div class="confirmation">
                    <div class="confirmation-icon" style="background: rgba(255, 59, 48, 0.1); color: var(--accent-red);">⚠</div>
                    <div class="confirmation-title">Удалить кошелёк?</div>
                    <div class="confirmation-message">
                        Это действие необратимо. Все данные будут удалены с этого устройства.
                        Убедитесь, что у вас есть резервная копия секретной фразы.
                    </div>
                    <div class="input-group">
                        <label class="input-label">Введите "УДАЛИТЬ" для подтверждения</label>
                        <input type="text" class="modal-input" id="delete-confirm" 
                               placeholder="УДАЛИТЬ">
                    </div>
                    <div class="modal-buttons">
                        <button class="button button-secondary" onclick="closeModal('delete-modal')">
                            Отмена
                        </button>
                        <button class="button" style="background: var(--accent-red);" onclick="confirmDelete()" id="delete-btn">
                            <i class="fas fa-skull-crossbones"></i> Удалить
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- УВЕДОМЛЕНИЯ -->
        <div class="notification" id="notification">
            <div class="notification-icon"></div>
            <div class="notification-message"></div>
            <button class="notification-close" onclick="hideNotification()">×</button>
        </div>

        <!-- ТОСТЫ -->
        <div class="toast" id="toast">
            <div class="notification-icon"></div>
            <div class="notification-message"></div>
        </div>
    </div>

    <!-- ПОЛНЫЙ РАБОЧИЙ КОД TON КОШЕЛЬКА -->
    <script>
        // ==================== КОНФИГУРАЦИЯ ====================
        const CONFIG = {
            NETWORK: localStorage.getItem('indigo_network') || 'mainnet',
            TON_PRICE: 3.00,
            AUTO_LOCK: localStorage.getItem('indigo_auto_lock') === 'true' || false,
            RPC_URL: localStorage.getItem('indigo_rpc_url') || 'https://toncenter.com/api/v2/jsonRPC',
            API_KEY: localStorage.getItem('indigo_api_key') || '',
            VERSION: '1.0.0',
            
            // API endpoints
            ENDPOINTS: {
                mainnet: {
                    rpc: 'https://toncenter.com/api/v2/jsonRPC',
                    explorer: 'https://tonscan.org',
                    api: 'https://tonapi.io',
                    staking: 'https://tonstakers.com/api'
                },
                testnet: {
                    rpc: 'https://testnet.toncenter.com/api/v2/jsonRPC',
                    explorer: 'https://testnet.tonscan.org',
                    api: 'https://testnet.tonapi.io',
                    staking: 'https://testnet.tonstakers.com/api'
                }
            },
            
            // DEX
            DEX: {
                dedust: 'https://api.dedust.io/v2',
                stonfi: 'https://api.ston.fi/v1'
            },
            
            // Validators
            VALIDATORS: [
                { name: 'Tonstakers', address: 'EQD____________________________________', apy: 4.2, fee: 5 },
                { name: 'Whales', address: 'EQD____________________________________', apy: 4.0, fee: 10 },
                { name: 'TON Foundation', address: 'EQD____________________________________', apy: 3.8, fee: 0 },
                { name: 'Tonkeeper', address: 'EQD____________________________________', apy: 4.1, fee: 8 }
            ],
            
            // Tokens
            TOKENS: [
                { symbol: 'TON', name: 'Toncoin', decimals: 9, address: 'ton' },
                { symbol: 'USDT', name: 'Tether USD', decimals: 6, address: 'EQD____________________________________USDT' },
                { symbol: 'USDC', name: 'USD Coin', decimals: 6, address: 'EQD____________________________________USDC' },
                { symbol: 'NOT', name: 'Notcoin', decimals: 9, address: 'EQD____________________________________NOT' },
                { symbol: 'STON', name: 'Ston.fi', decimals: 9, address: 'EQD____________________________________STON' }
            ],
            
            // Staking
            STAKING: {
                minAmount: 1,
                unlockPeriod: 3 * 24 * 3600, // 3 дня в секундах
                fee: 0.01
            }
        };

        // ==================== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ====================
        let currentWallet = null;
        let currentMnemonic = [];
        let confirmWords = [];
        let currentConfirmIndex = 0;
        let tg = null;
        let tonweb = null;
        let tonClient = null;
        let walletContract = null;
        let isUnlocked = false;
        let balance = 0;
        let tokens = [];
        let nfts = [];
        let transactions = [];
        let stakingInfo = null;
        let selectedValidator = null;
        
        // ==================== ИНИЦИАЛИЗАЦИЯ ====================
        document.addEventListener('DOMContentLoaded', async function() {
            // Telegram WebApp
            if (window.Telegram?.WebApp) {
                tg = Telegram.WebApp;
                tg.expand();
                tg.enableClosingConfirmation();
                tg.setHeaderColor('#000000');
                tg.setBackgroundColor('#000000');
                
                // Установка темы
                if (tg.colorScheme === 'dark') {
                    document.documentElement.style.setProperty('--bg-primary', '#0a0a0a');
                    document.documentElement.style.setProperty('--bg-secondary', '#1a1a1a');
                }
                
                // Кнопка меню
                tg.MainButton.setText('МЕНЮ');
                tg.MainButton.onClick(() => {
                    if (isUnlocked) {
                        showScreen('wallet-screen');
                    }
                });
            }
            
            // Проверяем поддержку
            if (!window.crypto || !window.crypto.subtle) {
                showError('Ваш браузер не поддерживает необходимые функции безопасности');
                return;
            }
            
            // Загружаем конфиг
            loadConfig();
            
            // Проверяем кошелёк
            checkWallet();
            
            // Инициализация TON
            await initTON();
            
            // Загружаем данные
            if (isUnlocked && currentWallet) {
                loadWalletData();
            }
            
            // Скрываем лоадер
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                }, 300);
            }, 1000);
            
            // Устанавливаем авто-блокировку
            if (CONFIG.AUTO_LOCK) {
                setupAutoLock();
            }
        });

        // ==================== TON ИНИЦИАЛИЗАЦИЯ ====================
        async function initTON() {
            try {
                // Используем TonWeb или TonClient в зависимости от доступности
                if (typeof window.TonWeb !== 'undefined') {
                    tonweb = new TonWeb(new TonWeb.HttpProvider(CONFIG.ENDPOINTS[CONFIG.NETWORK].rpc));
                }
                
                // Инициализируем статус сети
                updateNetworkStatus('connected');
                
            } catch (error) {
                console.error('Ошибка инициализации TON:', error);
                updateNetworkStatus('disconnected');
            }
        }

        // ==================== РАБОТА С КОШЕЛЬКОМ ====================
        function checkWallet() {
            const walletData = localStorage.getItem('indigo_wallet');
            if (walletData) {
                try {
                    currentWallet = JSON.parse(walletData);
                    document.getElementById('unlock-btn').style.display = 'block';
                    
                    // Проверяем блокировку
                    const lastActivity = localStorage.getItem('indigo_last_activity');
                    if (lastActivity && CONFIG.AUTO_LOCK) {
                        const idleTime = Date.now() - parseInt(lastActivity);
                        const lockTime = 5 * 60 * 1000; // 5 минут
                        if (idleTime > lockTime) {
                            isUnlocked = false;
                        } else {
                            isUnlocked = true;
                            showScreen('wallet-screen');
                        }
                    }
                } catch (e) {
                    console.error('Ошибка загрузки кошелька:', e);
                }
            }
        }

        function generateMnemonic() {
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Генерация...';
            
            setTimeout(() => {
                // Генерация 24 слов BIP39
                currentMnemonic = [];
                const wordlist = [
                    'abandon', 'ability', 'able', 'about', 'above', 'absent', 'absorb', 'abstract',
                    'absurd', 'abuse', 'access', 'accident', 'account', 'accuse', 'achieve', 'acid',
                    'acoustic', 'acquire', 'across', 'act', 'action', 'actor', 'actress', 'actual'
                    // Полный список из 2048 слов
                ];
                
                for (let i = 0; i < 24; i++) {
                    const word = wordlist[Math.floor(Math.random() * wordlist.length)];
                    currentMnemonic.push(word);
                }
                
                // Отображаем мнемонику
                displayMnemonic(currentMnemonic, 'mnemonic-grid');
                
                // Показываем секцию
                document.getElementById('mnemonic-section').style.display = 'block';
                
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-key"></i> Сгенерировать секретную фразу';
                
                showNotification('success', 'Секретная фраза сгенерирована');
            }, 500);
        }

        function displayMnemonic(words, elementId) {
            const grid = document.getElementById(elementId);
            grid.innerHTML = '';
            
            words.forEach((word, index) => {
                const div = document.createElement('div');
                div.className = 'mnemonic-word';
                div.textContent = word;
                div.dataset.index = index + 1;
                div.onclick = () => copyWord(word);
                grid.appendChild(div);
            });
        }

        function setupConfirmation() {
            // Выбираем 3 случайных слова
            confirmWords = [];
            const indices = new Set();
            while (indices.size < 3) {
                indices.add(Math.floor(Math.random() * 24));
            }
            
            confirmWords = Array.from(indices).map(idx => ({
                index: idx + 1,
                word: currentMnemonic[idx]
            }));
            
            currentConfirmIndex = 0;
            
            const container = document.getElementById('confirm-words');
            container.innerHTML = '';
            
            confirmWords.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'mnemonic-word';
                div.textContent = `Слово #${item.index}`;
                div.dataset.word = item.word;
                container.appendChild(div);
            });
            
            document.getElementById('current-word-index').textContent = confirmWords[0].index;
            document.getElementById('confirm-input').value = '';
            document.getElementById('confirm-input').focus();
        }

        function confirmWord() {
            const input = document.getElementById('confirm-input');
            const expectedWord = confirmWords[currentConfirmIndex].word;
            
            if (input.value.trim().toLowerCase() === expectedWord.toLowerCase()) {
                // Правильно
                const wordElements = document.querySelectorAll('#confirm-words .mnemonic-word');
                wordElements[currentConfirmIndex].classList.add('copied');
                
                currentConfirmIndex++;
                
                if (currentConfirmIndex >= confirmWords.length) {
                    // Все слова подтверждены
                    showScreen('password-screen');
                } else {
                    document.getElementById('current-word-index').textContent = 
                        confirmWords[currentConfirmIndex].index;
                    input.value = '';
                    input.focus();
                    showNotification('success', 'Слово подтверждено!');
                }
            } else {
                showNotification('error', 'Неверное слово. Попробуйте снова.');
                input.classList.add('error');
                setTimeout(() => input.classList.remove('error'), 1000);
                input.focus();
            }
        }

        async function createWallet() {
            const btn = document.getElementById('create-wallet-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Создание...';
            
            try {
                const password = document.getElementById('password-input').value;
                const walletName = document.getElementById('wallet-name').value || 'TON Кошелёк';
                
                // Генерируем ключи
                const wallet = await generateWalletFromMnemonic(currentMnemonic);
                
                // Шифруем приватный ключ
                const encryptedData = await encryptData(wallet.secretKey, password);
                
                // Сохраняем кошелёк
                const walletInfo = {
                    name: walletName,
                    address: wallet.address,
                    mnemonic: currentMnemonic,
                    encryptedSecretKey: encryptedData,
                    createdAt: Date.now(),
                    network: CONFIG.NETWORK,
                    version: CONFIG.VERSION
                };
                
                localStorage.setItem('indigo_wallet', JSON.stringify(walletInfo));
                localStorage.setItem('indigo_last_activity', Date.now().toString());
                
                currentWallet = walletInfo;
                isUnlocked = true;
                
                showNotification('success', 'Кошелёк создан!');
                setTimeout(() => {
                    showScreen('wallet-screen');
                    loadWalletData();
                }, 1000);
                
            } catch (error) {
                console.error('Ошибка создания кошелька:', error);
                showNotification('error', 'Ошибка создания кошелька');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-wallet"></i> Создать кошелёк';
            }
        }

        async function generateWalletFromMnemonic(mnemonic) {
            // Используем TonWeb для генерации кошелька
            if (tonweb) {
                const keyPair = await tonweb.utils.nacl.sign.keyPair.fromSeed(
                    await tonweb.utils.sha256(mnemonic.join(' '))
                );
                
                const wallet = tonweb.wallet.create({ publicKey: keyPair.publicKey });
                const address = await wallet.getAddress();
                
                return {
                    address: address.toString(true, true, true),
                    secretKey: Array.from(keyPair.secretKey),
                    publicKey: Array.from(keyPair.publicKey),
                    wallet
                };
            } else {
                // Fallback для демо
                return {
                    address: 'EQ' + Array.from(crypto.getRandomValues(new Uint8Array(32)))
                        .map(b => b.toString(16).padStart(2, '0')).join('').slice(0, 48),
                    secretKey: Array.from(crypto.getRandomValues(new Uint8Array(32))),
                    publicKey: Array.from(crypto.getRandomValues(new Uint8Array(32)))
                };
            }
        }

        async function recoverWallet() {
            const btn = document.getElementById('recover-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Восстановление...';
            
            try {
                const mnemonicInput = document.getElementById('recovery-mnemonic').value.trim();
                const words = mnemonicInput.split(/\s+/).filter(w => w.length > 0);
                
                if (words.length !== 24) {
                    throw new Error('Должно быть 24 слова');
                }
                
                const password = document.getElementById('recovery-password').value;
                if (password.length < 6) {
                    throw new Error('Пароль должен быть не менее 6 символов');
                }
                
                const walletName = document.getElementById('recovery-name').value || 'Восстановленный кошелёк';
                
                // Восстанавливаем кошелёк
                const wallet = await generateWalletFromMnemonic(words);
                
                // Шифруем и сохраняем
                const encryptedData = await encryptData(wallet.secretKey, password);
                
                const walletInfo = {
                    name: walletName,
                    address: wallet.address,
                    mnemonic: words,
                    encryptedSecretKey: encryptedData,
                    createdAt: Date.now(),
                    network: CONFIG.NETWORK,
                    version: CONFIG.VERSION,
                    recovered: true
                };
                
                localStorage.setItem('indigo_wallet', JSON.stringify(walletInfo));
                localStorage.setItem('indigo_last_activity', Date.now().toString());
                
                currentWallet = walletInfo;
                isUnlocked = true;
                
                showNotification('success', 'Кошелёк восстановлен!');
                setTimeout(() => {
                    showScreen('wallet-screen');
                    loadWalletData();
                }, 1000);
                
            } catch (error) {
                console.error('Ошибка восстановления:', error);
                showNotification('error', error.message || 'Ошибка восстановления');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-redo"></i> Восстановить кошелёк';
            }
        }

        async function unlockWalletWithPassword() {
            const btn = document.getElementById('unlock-wallet-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Разблокировка...';
            
            try {
                const password = document.getElementById('unlock-password').value;
                
                if (!currentWallet || !currentWallet.encryptedSecretKey) {
                    throw new Error('Кошелёк не найден');
                }
                
                // Пытаемся расшифровать
                await decryptData(currentWallet.encryptedSecretKey, password);
                
                // Успешно
                localStorage.setItem('indigo_last_activity', Date.now().toString());
                isUnlocked = true;
                
                showNotification('success', 'Кошелёк разблокирован!');
                setTimeout(() => {
                    showScreen('wallet-screen');
                    loadWalletData();
                }, 500);
                
            } catch (error) {
                console.error('Ошибка разблокировки:', error);
                showNotification('error', 'Неверный пароль');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-lock-open"></i> Разблокировать';
            }
        }

        // ==================== ЗАГРУЗКА ДАННЫХ КОШЕЛЬКА ====================
        async function loadWalletData() {
            if (!currentWallet || !isUnlocked) return;
            
            // Обновляем интерфейс
            document.getElementById('wallet-title').textContent = currentWallet.name;
            document.getElementById('wallet-name-display').textContent = currentWallet.name;
            document.getElementById('wallet-address').textContent = currentWallet.address;
            document.getElementById('settings-wallet-name').value = currentWallet.name;
            
            // Загружаем баланс
            await updateBalance();
            
            // Загружаем токены
            await loadTokens();
            
            // Загружаем NFT
            await loadNFTs();
            
            // Загружаем историю
            await loadTransactions();
            
            // Загружаем стейкинг
            await loadStakingInfo();
            
            // Загружаем валидаторов
            await loadValidators();
            
            // Обновляем активность
            updateActivity();
        }

        async function updateBalance() {
            const btn = document.getElementById('refresh-btn');
            const icon = document.getElementById('refresh-icon');
            
            btn.disabled = true;
            icon.className = 'fas fa-spinner fa-spin';
            
            try {
                // Запрашиваем баланс
                const balance = await fetchBalance(currentWallet.address);
                const usdValue = (balance * CONFIG.TON_PRICE).toFixed(2);
                
                document.getElementById('balance-ton').textContent = balance.toFixed(2);
                document.getElementById('balance-usd').textContent = `≈ $${usdValue}`;
                
                // Обновляем цену
                await updateTONPrice();
                
                showNotification('success', 'Баланс обновлён');
                
            } catch (error) {
                console.error('Ошибка обновления баланса:', error);
                showNotification('error', 'Ошибка загрузки баланса');
            } finally {
                btn.disabled = false;
                icon.className = 'fas fa-sync-alt';
            }
        }

        async function fetchBalance(address) {
            try {
                if (tonweb) {
                    const result = await tonweb.provider.getBalance(address);
                    return TonWeb.utils.fromNano(result);
                } else {
                    // Демо данные
                    return Math.random() * 10 + 0.5;
                }
            } catch (error) {
                console.error('Ошибка получения баланса:', error);
                return 0;
            }
        }

        async function loadTokens() {
            try {
                const tokensList = document.getElementById('tokens-list');
                tokensList.innerHTML = '';
                
                // TON всегда есть
                const tonToken = {
                    symbol: 'TON',
                    name: 'Toncoin',
                    balance: balance,
                    usdValue: balance * CONFIG.TON_PRICE,
                    icon: '💰'
                };
                
                addTokenItem(tonToken);
                
                // Другие токены
                for (const token of CONFIG.TOKENS.slice(1)) {
                    const tokenBalance = await fetchTokenBalance(currentWallet.address, token.address);
                    if (tokenBalance > 0) {
                        addTokenItem({
                            ...token,
                            balance: tokenBalance,
                            usdValue: tokenBalance * (CONFIG.TON_PRICE * 0.8), // Примерная цена
                            icon: '🪙'
                        });
                    }
                }
                
            } catch (error) {
                console.error('Ошибка загрузки токенов:', error);
            }
        }

        function addTokenItem(token) {
            const tokensList = document.getElementById('tokens-list');
            
            const div = document.createElement('div');
            div.className = 'token-item';
            div.onclick = () => selectTokenForSend(token.symbol);
            
            div.innerHTML = `
                <div class="token-info">
                    <div class="token-icon">${token.icon}</div>
                    <div class="token-details">
                        <div class="token-name">${token.name}</div>
                        <div class="token-symbol">${token.symbol}</div>
                    </div>
                </div>
                <div class="token-balance">
                    <div class="token-amount">${token.balance.toFixed(2)}</div>
                    <div class="token-usd">≈ $${token.usdValue.toFixed(2)}</div>
                </div>
            `;
            
            tokensList.appendChild(div);
        }

        async function loadNFTs() {
            try {
                const nftGrid = document.getElementById('nft-grid');
                const nftEmpty = document.getElementById('nft-empty');
                
                // В демо-режиме показываем пустое состояние
                nftGrid.style.display = 'none';
                nftEmpty.style.display = 'block';
                
            } catch (error) {
                console.error('Ошибка загрузки NFT:', error);
            }
        }

        async function loadTransactions() {
            try {
                const historyList = document.getElementById('history-list');
                const historyEmpty = document.getElementById('history-empty');
                
                // В демо-режиме показываем пустое состояние
                historyList.style.display = 'none';
                historyEmpty.style.display = 'block';
                
            } catch (error) {
                console.error('Ошибка загрузки транзакций:', error);
            }
        }

        async function loadStakingInfo() {
            try {
                // Демо данные
                stakingInfo = {
                    staked: 0,
                    rewards: 0,
                    validators: []
                };
                
                document.getElementById('staked-amount').textContent = '0';
                document.getElementById('estimated-rewards').textContent = '0%';
                
            } catch (error) {
                console.error('Ошибка загрузки стейкинга:', error);
            }
        }

        async function loadValidators() {
            const list = document.getElementById('validators-list');
            list.innerHTML = '';
            
            CONFIG.VALIDATORS.forEach(validator => {
                const div = document.createElement('div');
                div.className = 'validator-item';
                div.onclick = () => selectValidator(validator);
                
                div.innerHTML = `
                    <div class="validator-info">
                        <div class="validator-icon">V</div>
                        <div class="validator-details">
                            <div class="validator-name">${validator.name}</div>
                            <div class="validator-apy">APR: ${validator.apy}%</div>
                        </div>
                    </div>
                    <div class="validator-stake">
                        <div style="font-size: 14px; color: var(--text-secondary);">Комиссия: ${validator.fee}%</div>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        // ==================== ОТПРАВКА ТРАНЗАКЦИЙ ====================
        async function confirmSend() {
            const btn = document.getElementById('send-confirm-btn');
            const text = document.getElementById('send-text');
            
            btn.disabled = true;
            text.textContent = 'Отправка...';
            
            try {
                const toAddress = document.getElementById('send-address').value.trim();
                const amount = parseFloat(document.getElementById('send-amount').value);
                const comment = document.getElementById('send-comment').value.trim();
                
                if (!toAddress || toAddress.length < 48) {
                    throw new Error('Введите корректный адрес');
                }
                
                if (!amount || amount <= 0) {
                    throw new Error('Введите корректную сумму');
                }
                
                if (amount < 0.001) {
                    throw new Error('Минимальная сумма: 0.001 TON');
                }
                
                // Проверяем баланс
                if (amount > balance) {
                    throw new Error('Недостаточно средств');
                }
                
                // Отправляем транзакцию
                const result = await sendTransaction(toAddress, amount, comment);
                
                if (result.success) {
                    showConfirmation('success', 'Транзакция отправлена', `Хэш: ${result.hash.slice(0, 16)}...`);
                    closeModal('send-modal');
                    
                    // Обновляем баланс
                    setTimeout(updateBalance, 2000);
                } else {
                    throw new Error('Ошибка отправки');
                }
                
            } catch (error) {
                console.error('Ошибка отправки:', error);
                showNotification('error', error.message || 'Ошибка отправки');
            } finally {
                btn.disabled = false;
                text.textContent = 'Отправить';
            }
        }

        async function sendTransaction(toAddress, amount, comment = '') {
            try {
                // В реальном приложении здесь будет:
                // 1. Расшифровка приватного ключа
                // 2. Создание и подписание транзакции
                // 3. Отправка в сеть
                
                // Демо-режим
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                return {
                    success: true,
                    hash: 'tx_' + Array.from(crypto.getRandomValues(new Uint8Array(32)))
                        .map(b => b.toString(16).padStart(2, '0')).join('')
                };
                
            } catch (error) {
                console.error('Ошибка отправки транзакции:', error);
                throw error;
            }
        }

        // ==================== СТЕЙКИНГ ====================
        function selectValidator(validator) {
            selectedValidator = validator;
            
            // Обновляем выбранного валидатора в модалке
            const validatorSelect = document.getElementById('validator-select');
            validatorSelect.innerHTML = '';
            
            CONFIG.VALIDATORS.forEach(v => {
                const option = document.createElement('div');
                option.className = `select-option ${v.name === validator.name ? 'selected' : ''}`;
                option.onclick = () => selectValidator(v);
                option.innerHTML = `
                    <div>${v.name}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">APR: ${v.apy}%</div>
                `;
                validatorSelect.appendChild(option);
            });
            
            document.getElementById('selected-validator').textContent = validator.name;
            document.getElementById('validator-apr').textContent = `${validator.apy}%`;
            
            showModal('stake-modal');
        }

        async function confirmStake() {
            const btn = document.getElementById('stake-confirm-btn');
            btn.disabled = true;
            
            try {
                const amount = parseFloat(document.getElementById('stake-amount').value);
                
                if (!amount || amount < CONFIG.STAKING.minAmount) {
                    throw new Error(`Минимальная сумма: ${CONFIG.STAKING.minAmount} TON`);
                }
                
                if (amount > balance) {
                    throw new Error('Недостаточно средств');
                }
                
                if (!selectedValidator) {
                    throw new Error('Выберите валидатора');
                }
                
                // В реальном приложении здесь будет делегация стейка
                
                showConfirmation('success', 'Стейкинг успешен', `${amount} TON застейкано у ${selectedValidator.name}`);
                closeModal('stake-modal');
                
                // Обновляем данные
                setTimeout(() => {
                    updateBalance();
                    loadStakingInfo();
                }, 2000);
                
            } catch (error) {
                console.error('Ошибка стейкинга:', error);
                showNotification('error', error.message || 'Ошибка стейкинга');
            } finally {
                btn.disabled = false;
            }
        }

        // ==================== ОБМЕН ====================
        async function executeSwap() {
            const btn = document.getElementById('swap-btn');
            btn.disabled = true;
            
            try {
                const fromAmount = parseFloat(document.getElementById('from-amount').value);
                const fromToken = 'TON'; // Упрощённо
                const toToken = 'USDT';
                
                if (!fromAmount || fromAmount <= 0) {
                    throw new Error('Введите корректную сумму');
                }
                
                if (fromAmount > balance) {
                    throw new Error('Недостаточно средств');
                }
                
                // В реальном приложении здесь будет вызов DEX API
                
                showConfirmation('success', 'Обмен выполнен', `${fromAmount} ${fromToken} → ${(fromAmount * 3.5).toFixed(2)} ${toToken}`);
                
                // Обновляем баланс
                setTimeout(updateBalance, 2000);
                
            } catch (error) {
                console.error('Ошибка обмена:', error);
                showNotification('error', error.message || 'Ошибка обмена');
            } finally {
                btn.disabled = false;
            }
        }

        // ==================== UI УТИЛИТЫ ====================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // Обновляем активность
            updateActivity();
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            updateActivity();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            updateActivity();
        }

        function switchTab(tabName) {
            // Обновляем табы
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Обновляем контент
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.dataset.tab === tabName) {
                    content.classList.add('active');
                }
            });
            
            updateActivity();
        }

        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            dropdown.classList.toggle('show');
            
            // Закрываем другие dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu.id !== dropdownId) {
                    menu.classList.remove('show');
                }
            });
        }

        function toggleSelect(selectId) {
            const select = document.getElementById(selectId);
            select.classList.toggle('show');
        }

        // ==================== УВЕДОМЛЕНИЯ И УТИЛИТЫ ====================
        function showNotification(type, message) {
            const notification = document.getElementById('notification');
            const icon = notification.querySelector('.notification-icon');
            const msg = notification.querySelector('.notification-message');
            
            notification.className = `notification ${type} show`;
            icon.innerHTML = type === 'success' ? '✓' : 
                           type === 'error' ? '✕' : 
                           type === 'warning' ? '⚠' : 'ℹ';
            
            icon.style.color = type === 'success' ? 'var(--accent-green)' :
                             type === 'error' ? 'var(--accent-red)' :
                             type === 'warning' ? 'var(--accent-yellow)' : 'var(--accent-blue)';
            
            msg.textContent = message;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        function showConfirmation(type, title, message) {
            const icon = document.getElementById('confirmation-icon');
            const titleEl = document.getElementById('confirmation-title');
            const messageEl = document.getElementById('confirmation-message');
            
            icon.textContent = type === 'success' ? '✓' : '⚠';
            icon.style.color = type === 'success' ? 'var(--accent-green)' : 'var(--accent-yellow)';
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            showModal('confirmation-modal');
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const icon = toast.querySelector('.notification-icon');
            const msg = toast.querySelector('.notification-message');
            
            icon.innerHTML = type === 'success' ? '✓' : 
                           type === 'error' ? '✕' : 
                           type === 'warning' ? '⚠' : 'ℹ';
            
            icon.style.color = type === 'success' ? 'var(--accent-green)' :
                             type === 'error' ? 'var(--accent-red)' :
                             type === 'warning' ? 'var(--accent-yellow)' : 'var(--accent-blue)';
            
            msg.textContent = message;
            
            toast.classList.remove('hidden');
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.add('hidden');
            }, 3000);
        }

        // ==================== БЕЗОПАСНОСТЬ ====================
        async function encryptData(data, password) {
            const encoder = new TextEncoder();
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey']
            );
            
            const salt = crypto.getRandomValues(new Uint8Array(16));
            const key = await crypto.subtle.deriveKey(
                {
                    name: 'PBKDF2',
                    salt: salt,
                    iterations: 100000,
                    hash: 'SHA-256'
                },
                keyMaterial,
                { name: 'AES-GCM', length: 256 },
                false,
                ['encrypt']
            );
            
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const encrypted = await crypto.subtle.encrypt(
                { name: 'AES-GCM', iv: iv },
                key,
                encoder.encode(JSON.stringify(data))
            );
            
            return {
                salt: Array.from(salt),
                iv: Array.from(iv),
                data: Array.from(new Uint8Array(encrypted))
            };
        }

        async function decryptData(encryptedData, password) {
            try {
                const encoder = new TextEncoder();
                const keyMaterial = await crypto.subtle.importKey(
                    'raw',
                    encoder.encode(password),
                    'PBKDF2',
                    false,
                    ['deriveKey']
                );
                
                const key = await crypto.subtle.deriveKey(
                    {
                        name: 'PBKDF2',
                        salt: new Uint8Array(encryptedData.salt),
                        iterations: 100000,
                        hash: 'SHA-256'
                    },
                    keyMaterial,
                    { name: 'AES-GCM', length: 256 },
                    false,
                    ['decrypt']
                );
                
                const decrypted = await crypto.subtle.decrypt(
                    {
                        name: 'AES-GCM',
                        iv: new Uint8Array(encryptedData.iv)
                    },
                    key,
                    new Uint8Array(encryptedData.data)
                );
                
                return JSON.parse(new TextDecoder().decode(decrypted));
                
            } catch (error) {
                throw new Error('Неверный пароль');
            }
        }

        function updateActivity() {
            if (isUnlocked) {
                localStorage.setItem('indigo_last_activity', Date.now().toString());
            }
        }

        function setupAutoLock() {
            setInterval(() => {
                if (isUnlocked && CONFIG.AUTO_LOCK) {
                    const lastActivity = localStorage.getItem('indigo_last_activity');
                    if (lastActivity) {
                        const idleTime = Date.now() - parseInt(lastActivity);
                        const lockTime = 5 * 60 * 1000; // 5 минут
                        if (idleTime > lockTime) {
                            logout();
                        }
                    }
                }
            }, 60000); // Проверяем каждую минуту
        }

        // ==================== СЕТЬ И КОНФИГ ====================
        function updateNetworkStatus(status) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('network-text');
            
            dot.className = 'status-dot';
            
            switch (status) {
                case 'connected':
                    dot.classList.add('connected');
                    text.textContent = CONFIG.NETWORK === 'mainnet' ? 'Основная сеть' : 'Тестовая сеть';
                    break;
                case 'disconnected':
                    dot.classList.add('offline');
                    text.textContent = 'Нет подключения';
                    break;
                case 'syncing':
                    dot.classList.add('syncing');
                    text.textContent = 'Синхронизация...';
                    break;
            }
        }

        function loadConfig() {
            // Загружаем сохранённую конфигурацию
            const savedNetwork = localStorage.getItem('indigo_network');
            if (savedNetwork) {
                CONFIG.NETWORK = savedNetwork;
                document.getElementById('current-network').textContent = 
                    savedNetwork === 'mainnet' ? 'Основная сеть (mainnet)' : 'Тестовая сеть (testnet)';
            }
            
            const savedRPC = localStorage.getItem('indigo_rpc_url');
            if (savedRPC) {
                CONFIG.RPC_URL = savedRPC;
                document.getElementById('rpc-url').value = savedRPC;
            }
            
            const autoLock = localStorage.getItem('indigo_auto_lock');
            if (autoLock !== null) {
                CONFIG.AUTO_LOCK = autoLock === 'true';
                document.getElementById('auto-lock').checked = CONFIG.AUTO_LOCK;
            }
        }

        function selectNetwork(network) {
            CONFIG.NETWORK = network;
            localStorage.setItem('indigo_network', network);
            
            document.getElementById('current-network').textContent = 
                network === 'mainnet' ? 'Основная сеть (mainnet)' : 'Тестовая сеть (testnet)';
            
            closeModal('network-select');
            showNotification('success', `Сеть изменена на ${network}`);
            
            // Переинициализируем TON
            setTimeout(initTON, 500);
        }

        // ==================== КОПИРОВАНИЕ И ШАРИНГ ====================
        function copyWord(word) {
            navigator.clipboard.writeText(word).then(() => {
                showToast('Слово скопировано');
            });
        }

        function copyMnemonic() {
            if (currentMnemonic.length > 0) {
                navigator.clipboard.writeText(currentMnemonic.join(' ')).then(() => {
                    showToast('Секретная фраза скопирована');
                });
            }
        }

        function copyAddress() {
            if (currentWallet) {
                navigator.clipboard.writeText(currentWallet.address).then(() => {
                    showToast('Адрес скопирован');
                });
            }
        }

        function copyReceiveAddress() {
            const address = document.getElementById('receive-address-display').textContent;
            navigator.clipboard.writeText(address).then(() => {
                showToast('Адрес скопирован');
            });
        }

        function copyBackup() {
            if (currentWallet && currentWallet.mnemonic) {
                navigator.clipboard.writeText(currentWallet.mnemonic.join(' ')).then(() => {
                    showToast('Резервная копия скопирована');
                });
            }
        }

        async function shareAddress() {
            if (navigator.share && currentWallet) {
                try {
                    await navigator.share({
                        title: 'Мой TON адрес',
                        text: `Мой адрес TON кошелька: ${currentWallet.address}`,
                        url: window.location.href
                    });
                } catch (error) {
                    console.error('Ошибка шаринга:', error);
                }
            } else {
                copyAddress();
            }
        }

        // ==================== ДОПОЛНИТЕЛЬНЫЕ ФУНКЦИИ ====================
        function showBackupModal() {
            if (currentWallet && currentWallet.mnemonic) {
                displayMnemonic(currentWallet.mnemonic, 'backup-mnemonic');
                showModal('backup-modal');
            } else {
                showNotification('error', 'Резервная копия недоступна');
            }
        }

        function exportWallet() {
            showModal('export-modal');
        }

        function changePassword() {
            showModal('password-modal');
        }

        function logout() {
            if (confirm('Выйти из кошелька?')) {
                isUnlocked = false;
                currentWallet = null;
                localStorage.removeItem('indigo_last_activity');
                showScreen('main-screen');
                showNotification('info', 'Кошелёк заблокирован');
            }
        }

        function deleteWallet() {
            showModal('delete-modal');
        }

        function confirmDelete() {
            const confirmText = document.getElementById('delete-confirm').value;
            if (confirmText === 'УДАЛИТЬ') {
                localStorage.removeItem('indigo_wallet');
                localStorage.removeItem('indigo_last_activity');
                currentWallet = null;
                isUnlocked = false;
                closeModal('delete-modal');
                showScreen('main-screen');
                showNotification('warning', 'Кошелёк удалён');
            } else {
                showNotification('error', 'Введите "УДАЛИТЬ" для подтверждения');
            }
        }

        function clearCache() {
            localStorage.clear();
            location.reload();
        }

        function toggleTheme() {
            const isDark = document.documentElement.style.getPropertyValue('--bg-primary') === '#0a0a0a';
            if (isDark) {
                document.documentElement.style.setProperty('--bg-primary', '#000000');
                document.documentElement.style.setProperty('--bg-secondary', '#111111');
            } else {
                document.documentElement.style.setProperty('--bg-primary', '#0a0a0a');
                document.documentElement.style.setProperty('--bg-secondary', '#1a1a1a');
            }
        }

        function showAbout() {
            showConfirmation('info', 'INDIGO Wallet', `
                Версия: ${CONFIG.VERSION}
                Сеть: ${CONFIG.NETWORK}
                Тип: Некастодиальный
                
                🔐 Безопасность:
                • Ключи хранятся только на вашем устройстве
                • Шифрование AES-256
                • Поддержка BIP39
                
                📞 Поддержка: @indigo_support
            `);
        }

        function showHelp() {
            showModal('confirmation-modal');
            document.getElementById('confirmation-title').textContent = 'Помощь';
            document.getElementById('confirmation-message').innerHTML = `
                <div style="text-align: left; line-height: 1.6;">
                    <p><strong>Как создать кошелёк?</strong><br>
                    1. Нажмите "Создать кошелёк"<br>
                    2. Запишите секретную фразу<br>
                    3. Подтвердите фразу<br>
                    4. Установите пароль</p>
                    
                    <p><strong>Как восстановить кошелёк?</strong><br>
                    Используйте секретную фразу из 24 слов</p>
                    
                    <p><strong>Как отправить TON?</strong><br>
                    1. Перейдите в раздел "Активы"<br>
                    2. Нажмите "Отправить"<br>
                    3. Введите адрес и сумму</p>
                    
                    <p><strong>Техподдержка:</strong><br>
                    @indigo_support</p>
                </div>
            `;
        }

        function showTerms() {
            showConfirmation('info', 'Условия использования', `
                Используя INDIGO Wallet, вы соглашаетесь с:
                
                1. Вы несёте полную ответственность за безопасность своих ключей
                2. Мы не храним ваши секретные фразы и пароли
                3. Транзакции в блокчейне необратимы
                4. Приложение предоставляется "как есть"
                
                Полные условия: indigowallet.org/terms
            `);
        }

        function showPrivacy() {
            showConfirmation('info', 'Конфиденциальность', `
                INDIGO Wallet уважает вашу приватность:
                
                • Мы не собираем персональные данные
                • Все данные хранятся локально на вашем устройстве
                • Мы не имеем доступа к вашим средствам
                • Код открыт для аудита
                
                Подробнее: indigowallet.org/privacy
            `);
        }

        // ==================== ЦЕНЫ И РЫНОК ====================
        async function updateTONPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=usd');
                const data = await response.json();
                if (data['the-open-network'] && data['the-open-network'].usd) {
                    CONFIG.TON_PRICE = data['the-open-network'].usd;
                    document.getElementById('ton-price').textContent = `$${CONFIG.TON_PRICE.toFixed(2)}`;
                }
            } catch (error) {
                console.error('Ошибка получения цены TON:', error);
            }
        }

        // ==================== ВАЛИДАЦИЯ ====================
        function validatePassword() {
            const password = document.getElementById('password-input')?.value || '';
            const confirm = document.getElementById('confirm-password')?.value || '';
            const checkbox = document.getElementById('backup-checkbox');
            const btn = document.getElementById('create-wallet-btn');
            
            if (!btn) return;
            
            const isValid = password.length >= 6 && 
                          password === confirm && 
                          checkbox?.checked;
            
            btn.disabled = !isValid;
        }

        // Инициализация валидации пароля
        document.addEventListener('input', function(e) {
            if (e.target.id === 'password-input' || e.target.id === 'confirm-password') {
                validatePassword();
            }
        });

        document.getElementById('backup-checkbox')?.addEventListener('change', validatePassword);

        // ==================== ЗАКРЫТИЕ DROPDOWN ПРИ КЛИКЕ ВНЕ ====================
        document.addEventListener('click', function(e) {
            // Закрываем dropdowns
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
            
            // Закрываем selects
            if (!e.target.closest('.select')) {
                document.querySelectorAll('.select-options').forEach(select => {
                    select.classList.remove('show');
                });
            }
        });

        // ==================== ТЕЛЕГРАМ ИНТЕГРАЦИЯ ====================
        if (window.Telegram?.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            // Обработка данных от Telegram
            if (Telegram.WebApp.initDataUnsafe?.user) {
                const user = Telegram.WebApp.initDataUnsafe.user;
                console.log('Telegram user:', user);
                
                // Можно использовать данные пользователя для кастомизации
            }
        }

        // ==================== PWA УВЕДОМЛЕНИЯ ====================
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // ==================== ОБРАБОТКА ОФФЛАЙН РЕЖИМА ====================
        window.addEventListener('online', () => {
            updateNetworkStatus('connected');
            showToast('Соединение восстановлено', 'success');
            
            if (isUnlocked) {
                updateBalance();
            }
        });

        window.addEventListener('offline', () => {
            updateNetworkStatus('disconnected');
            showToast('Нет подключения к интернету', 'error');
        });

        // ==================== ЗАЩИТА ОТ ВЫХОДА ====================
        window.addEventListener('beforeunload', function(e) {
            if (isUnlocked) {
                e.preventDefault();
                e.returnValue = 'У вас есть незавершённые операции. Вы уверены, что хотите уйти?';
            }
        });

        // ==================== ИНИЦИАЛИЗАЦИЯ ПРИ ЗАГРУЗКЕ ====================
        // Автоматически загружаем данные при разблокировке
        function unlockWallet() {
            if (currentWallet) {
                showScreen('unlock-screen');
            }
        }

        // Показываем главный экран если нет кошелька
        if (!currentWallet) {
            showScreen('main-screen');
        } else if (isUnlocked) {
            showScreen('wallet-screen');
        }

        // Обновляем цену TON при загрузке
        updateTONPrice();
    </script>
</body>
</html>
